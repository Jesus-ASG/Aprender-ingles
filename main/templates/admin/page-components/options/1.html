{% extends 'main_template.html' %}
{% load static %}

{% block title %} {{ story.title }} {% endblock %}

{% block page-styles %}
<link rel="stylesheet" href="{% static 'css/1.css' %}">
<style>
  .btn-add-dialog {
    min-width: 100px;
  }
</style>
{% endblock %}

{% block navbar %} {% include 'navbar-custom.html' %} {% endblock %}

{% block content %}
<form method="POST" action="{% url 'add_page' story.route 1 %}" enctype='multipart/form-data' autocomplete="off"
  id="save_page">
  {% csrf_token %}
  <div class="container main-content">
    <input class="fs-1 text-center mt-3 form-control" name="subtitle" placeholder="Subtítulo"></input>
    <input type="file" id="image" name="image" class="form-control" accept="image/*" onchange="changeImg(this)"
      hidden />
    <input type="number" id="max_elem" name="max_elem" hidden>

    <div class="mt-3" id="alert_removed_success"></div>

    <div class="row my-3">
      <div class="col-12">
        <div class="img-t-1">
          <img src="{{ story.cover.url }}" alt="No se pudo cargar la imagen" id="img_showed">
          <div class="row mt-1">
            <div class="col-12 col-md-6">
              <button class="btn btn-primary shadow-none fs-6 w-100 fw-bold" type="button"
                onclick="document.getElementById('image').click(); return false;">Cambiar imagen</button>
            </div>
            <div class="col-12 col-md-6">
              <button class="btn btn-info shadow-none fs-6 w-100 fw-bold" onclick="restoreImage()"
                type="button">Restaurar
                imagen</button>
            </div>
          </div>

        </div>
        <div class="fs-5">
          <div id="dialog_area"></div>
        </div>
        <div class="row mb-3">
          <div class="col-12 text-center">
            <button onclick="addDialog()" class="btn btn-primary shadow-none w-50 fs-5 
            fw-bold btn-add-dialog" id="add_dialog" type="button"> Agregar diálogo </button>
          </div>
        </div>
      </div>
    </div>
    <hr>
    <div class="row mb-3">
      <div class="col-12">
        <h2 class="fs-2 text-center my-3">Ejercicios de prueba</h2>
      </div>

      <div class="mb-3" id="row_dialog_`+num_d+`" name="row_dialog_`+num_d+`">

        <div class="row">
          <div class="col-12 mb-2">
            <textarea class="form-control fs-5 txta" type="text" name="repl1" id="repl1"
              placeholder="Contenido en español" maxlength="255"></textarea>
          </div>
        </div>
        <hr>
      </div>
      {% include "admin/exercises/select-exercise.html" %}
    </div>
    <hr>
    <div class="row mb-3">
      <div class="col-12 col-md-6 text-center">
        <a href="{% url 'view_pages' story.route %}" class="btn btn-danger shadow-none fs-5 fw-bold w-100"
          type="button"> Cancelar</a>
      </div>
      <div class="col-12 col-md-6 text-center">
        <button class="btn btn-primary shadow-none fs-5 fw-bold w-100" type="submit" form="save_page"> Guardar página
        </button>
      </div>
    </div>

  </div>

</form>
{% endblock %}

{% block page-scripts %}
<script>

  $(document).ready(function () {
    console.log("hi world");
    let x1 = document.getElementById("repl1");
    x1.style.height = (x1.style.fontSize) / 2;

    x1.style.height = `${x1.scrollHeight}px`;
    x1.addEventListener("keyup", e => {
      x1.style.height = (x1.style.fontSize) / 2;
      let h = e.target.scrollHeight;
      x1.style.height = `${h}px`;


    });
  });

  function restoreImage() {
    $("#img_showed").attr("src", "{{ story.cover.url }}");
    $("#image").val("");
  }

  function changeImg(input) {
    if (input.value == "")
      restoreImage();
    if (input.files && input.files[0]) {
      let reader = new FileReader();
      reader.onload = function (e) {
        $("#img_showed").attr("src", e.target.result);
      };
      reader.readAsDataURL(input.files[0]);
    }
  }

</script>
<script src="{% static 'js/add-page.js' %}"></script>
{% endblock %}